# 使用的库

- vue3: 组合式api;使用typescript执行类型检查并提供更好的补全提示  
  - vue-router: 项目路由
- axios: 用于向后端发送请求
- Element-plus: 项目的主要组件库
- tailwindcss: 用于微调组件样式

# 文件结构说明

- 根目录: src(@)
  - 组件目录: @/components
  - 工具函数: @/net
  - 路由: @/router
  - 全局状态: @/stores

# 命名规范说明

`vue`组件的命名规范同官方推荐的风格指南，使用多单词驼峰命名
`vue`组件内`<script setup>`部分的命名规范，由上到下是(用单行注释划分)：  

- typescript声明的 `interface`: 接口命名格式为Format开头的驼峰命名
- 开关变量: 均以is开头，驼峰命名
- 局部(响应式)变量: 使用蛇形命名,Ref后缀,表示均为`ref`声明的响应式数据
- 特殊数据: 大部分是用于`element-plus`的组件数据，命名一般同局部变量
- 函数区: 蛇形命名,需要以常见的操作名开头

# 组件说明

## LoginView && RegisterView

使用`el-form`组件进行表单校验，若校验失败不会向后端发起请求,且操作有3秒的冷却时间    
登陆成功后，使用`localStorage`存储获取到的token,`sessionStorage`存储用户名  
注意: 携带非空的`token`进入登陆页会通过路由跳转到模型管理路径  

## AdminView

模型的增删查改操作都被集成在这个组件,由于后端实现了分页查询，因此前端只需要存储每次查询的结果  
一共有四个子组件，均以预加载的形式随着组件的初始化而挂载，但是组件内部的模板均以`v-if`指令实现懒加载，且只在调用子组件功能时向后端发送相关请求(通过模板引用实现)  
右下角的注销按钮将删除session与local存储里的字段，并为`states`里的字段赋初始值

### KeyAdmin

`KeyAdmin`(`accesskey`管理组件)开闭均由父组件的变量控制，父组件传入一个控制其开闭的变量`isKeyAdminOpen`,且通过一个`button`开启这个窗口，子组件设置一个被父组件监听的事件用于关闭窗口  
每次打开`KeyAdmin`窗口，都会重新向后端发送获取所有access-key的请求，此外，获取模型测试所用的key也通过这个子组件进行  

## UsageSelect

使用量查看界面的开闭实现和`KeyAdmin`一样  
进入界面时会获取当天日期并查询该天的使用量，随后可以通过日期选择器组件查询各个日期的使用量

## ModelTest2Text/ModelTest2Image

与父组件通信最频繁的两个组件，为了方便，将测试用的数据存在全局状态变量`states`中，简要流程：  

1. 若`states.KeyInUse`为空，尝试获取一个可用的key，这里涉及到异步问题
   1. 调用`get_accesskey()`,`get_accesskey()`等待`get_accesskeys()`,`get_accesskeys()`获取所有keys后，`get_accesskey()`尝试找一个可用的key存入`states`,否则返回
2. 点击测试后，检查这个模型的`capabilities`
   1. 若为空，返回；若长度为1，存入`states.CapInTese`，跳转下一步
   2. 长度大于1，弹出一个选择窗口，将选中的测试类型存入`states.CapInTese`,到下一步
3. 进入对应的测试组件（生文/生图）

组件开闭由内部开关变量决定，与父组件的通信通过`states`进行，输入信息都会进行表单校验，通过后才能发送给后端  

关于测试操作：  

- 默认情况下不发送任何可选字段，可以通过弹出窗口编辑另一份表单，`保存更改`实质上会将开关变量`isUsingOptionData`设置为`true`，这会让发送信息时将可选数据赋给请求表单的可选字段
- 注意：这个过程是不可逆的，即：点击`保存更改`且没有点击`取消更改`后，再发送测试信息，之后点击`重置测试`并不会删除可选字段，只有`退出测试`会删除可选字段
- 也就是：如果想不带自定义数据发送表单，最好在每次测试后先`退出测试`  

关于生图功能：

- 暂时只支持url格式的图片输入
- 目前支持的图片后缀是`[jpg,jpeg,png]`